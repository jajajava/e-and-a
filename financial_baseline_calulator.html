<!DOCTYPE html>

<html>
    <head>
        <style>
            #mainDiv {
                display: grid;
                grid-template-columns: 200px auto;
                column-gap: 20px;
            }
            input {
                margin-bottom: 10px;
                grid-column: 1;
                width: 200px;
            }
            #column2input{
                grid-column: 2;
                grid-row: 6;
            }
            label {
                grid-column: 1;
            }
            .delete{
                width: fit-content;
                height: 22px;
            }
            #addExpenseButton{
                grid-column: 2;
                grid-row: 2;
                width: fit-content;
                height: fit-content;
            }
            #calculateButton{
                grid-column: 2;
                grid-row: 4;
                width: fit-content;
                height: fit-content;
            }
        </style>
    </head>

    <body>
        <h1>Enter your monthly:</h1>

        <div id="mainDiv">
            <label for="salaryInput">Annual salary (optional)</br></label>
            <input id="salaryInput"/>

            <label for="rentInput">Rent/mortgage</br></label>
            <input id="rentInput"/>

            <label for="utilitiesInput">Utilities</br></label>
            <input id="utilitiesInput"/>

            <label for="carInput">Car insurance</br></label>
            <input id="carInput"/>

            <label for="healthInput">Health insurance</br></label>
            <input id="healthInput"/>

            <button id="addExpenseButton">Add expense</button>
            <button id="calculateButton">Calculate</button>
        </div>
        <p id="output"></p>


        <script>
            let constantExpenses = [
                document.getElementById("salaryInput"),
                document.getElementById("rentInput"),
                document.getElementById("utilitiesInput"),
                document.getElementById("carInput"),
                document.getElementById("healthInput")
            ]

            const customExpenses = []

            document.getElementById("addExpenseButton").addEventListener("click", addExpense);
            document.getElementById("calculateButton").addEventListener("click", () => calculate());

            function addExpense() {
                const mainDiv = document.getElementById("mainDiv");

                if (document.getElementById("column2input")) return;

                const column2input = document.createElement("div");
                column2input.id = "column2input";

                column2input.innerHTML = `
                <input id="expenseLabelInput" placeholder="label"/>
                <button id="saveAddExpense">Save</button>
                <button id="cancelAddExpense">Cancel</button>
                `;

                const labelInput = column2input.querySelector("#expenseLabelInput");
                const saveBtn = column2input.querySelector("#saveAddExpense");
                const cancelBtn = column2input.querySelector("#cancelAddExpense");

                cancelBtn.addEventListener("click", closeAddExpense);

                saveBtn.addEventListener("click", () => {
                let label = labelInput.value.trim();
                if (!label) return; // If no label is given

                label = label.toLowerCase().replace(/\s+/g, "_");

                const tempId = `${label}Input`
                if (document.getElementById(tempId) != null) return;

                saveAddExpense(label);
                });

                mainDiv.appendChild(column2input);
            }

            function saveAddExpense(label) {
                const mainDiv = document.getElementById("mainDiv");

                const newLabel = document.createElement("label");
                newLabel.setAttribute("for", `${label}Input`);
                const upperLabel = label[0].toUpperCase() + label.slice(1);
                newLabel.innerHTML = `${upperLabel}<br>`;
                newLabel.id = `${label}Label`;
                
                const newInput = document.createElement("input");
                newInput.id = `${label}Input`
                newInput.innerHTML = `${label}Input"`;

                const newDelete = document.createElement("button");
                newDelete.id = `${label}Delete`;
                newDelete.className = "delete"
                newDelete.innerHTML = `ðŸ—‘ï¸`
                newDelete.addEventListener("click", ()=> {deleteExpense(label)});

                mainDiv.appendChild(newLabel);
                mainDiv.appendChild(newInput);
                mainDiv.appendChild(newDelete);

                customExpenses.push(newInput);

                closeAddExpense();
            }

            function deleteExpense(label){
                const labelEl = document.getElementById(`${label}Label`);
                const inputEl = document.getElementById(`${label}Input`);
                const buttonEl = document.getElementById(`${label}Delete`);

                labelEl.remove();
                inputEl.remove();
                buttonEl.remove();

                const tempIndex = customExpenses.indexOf(label);
                customExpenses.splice(tempIndex, 1);
            }

            function closeAddExpense() {
                document.getElementById("column2input")?.remove();
            }

            function calculate() {
                const outputEl = document.getElementById("output");

                try {
                    // Get all values
                    let total = 0;
                    let salary = Number(constantExpenses[0].value);

                    let copyConstantExpenses = constantExpenses.slice(1);

                    copyConstantExpenses.forEach((item) => {
                        total += Number(item.value);
                    })

                    customExpenses.forEach((item) => {
                        total += Number(item.value);
                    })

                    if (salary > 0 && salary !== undefined){
                        let output = ((salary - ((salary * 0.05) + (salary * 0.22))) / 12) - total; // Monthly salary minus total. Subtracts 5% state income tax, 22% federal income tax.
                        outputEl.innerHTML = `Post tax monthly salary - total monthly spending = $${output.toFixed(2)}`;
                    } else {
                        outputEl.innerHTML = `Total monthly spending: $${total.toFixed(2)}`;
                    }
                    
                } catch (error) { // NaNs should be safely ignored by default when converting to Number
                    outputEl.innerHTML = error;
                }
            }
        </script>
    </body>
</html>